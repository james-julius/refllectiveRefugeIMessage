<!DOCTYPE html>
<html>
    <head>
        <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
        <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    </head>
<body>
    <div id="react-component-container">**drumroll**</div>
</body>
<foot>
<script type="text/babel">
const data = {
    spotifyURI: "https://open.spotify.com/track/3PFnF7lmHOxoYGXhxUkzCE?si=Kjoy_nseQ_2-OxGTRQvTag",
    messages: [
      {
        isArtist: true,
        text: `How's isolation been for you?`,
      },
      {
        isArtist: false,
        text: `Not too bad thanks`,
      },
      {
        isArtist: true,
        text: `Have you been making lots of music? `,
      },
      {
        isArtist: false,
        text: `Oh yeah`,
      },
    ],
    name: 'James Julius'
}

const Header = ({name, initials}) => {

    function getTime(){
        let date = new Date();

        let hours = date.getHours();
        if( hours > 12 ){
            hours -= 12;
        }else if( hours === 0){
            hours = 12;
        }
        let minutes = ("00" + date.getMinutes()).substr(-2);

        return hours+':'+minutes;
    }
    
    return (
  <div className={'header'}>
    <div className={'icons'}>
      <span className={'left-icons'}>
        <div className={'clock'}>
        {getTime()}
        </div>
        <span class="iconify" data-icon="carbon:location-current" data-inline="false"></span>
      </span>
      <span className={'right-icons'}>
        <span class="iconify" data-icon="ion:cellular" data-inline="false"></span>
        &nbsp;
        <span class="iconify" data-icon="ion:wifi" data-inline="false"></span>
        &nbsp;
        <span class="iconify" data-icon="ion:battery-full" data-inline="false"></span>
      </span>
    </div>
    <div className={'messenger-header'}>
        <span className={'back-arrow'}>
            <span class="iconify" data-icon="ion-ios-arrow-back" data-inline="false"></span>
        </span>
        <span className={"user-detail"}>
            <div className={"user-icon"}>
                {initials}
            </div>
            <p className={"user-name"}>
                {name}
                <span class="iconify right-arrow" data-icon="ic:outline-arrow-forward-ios" data-inline="false"></span>
            </p>
         </span>
    </div>
  </div>
)};

const Message = ({ isArtist, text }) => {
  let className = (isArtist ? "yours" : "mine");

  return (
    <div className={"messages animated slideInUp fast " + className}>
      <p className={"message"}>
        {text}
      </p>
    </div>
  )
};


const MessageHistory = ({ messages }) => (
  <div className={"chat"}>
    {messages.map((msg, idx) => (<Message key={idx} {...msg} />))}
  </div>
);

function SpotifyBar({
  spotifyURI,
}) {

  function makeSpotifyLink(input) {
    if (input.includes('/track/')) {
    input = input.replace('/track/', '/embed/track/')
    }
    
    if (input.includes('/album/')) {
      input = input.replace("/album/", "/embed/album/");
    }

    for (let n = 2; n < input.length; n++) {
      let j = input[n - 2];
      let k = input[n - 1];
      let l = input[n];
      if (j === '?' && k === 's' && l === 'i') {
        input = input.substring(0, n - 2);
      }
    }
    return input;
  }

  return (
    <iframe
      title="spotify-player"
      src={makeSpotifyLink(spotifyURI)}
      width="100%"
      height="100"
      frameborder="0"
      allowtransparency="true"
      allow="encrypted-media"
    ></iframe>
  );
}

const CollapsedInputFooter = ({spotifyURI}) => (
  <div className={'input-view'}>
    <SpotifyBar spotifyURI={spotifyURI}/>
  </div>
);

const Phone = () => {
  function initialiseName() {
    let splitName = data.name.split(' ');
    return splitName[0][0].toUpperCase() + splitName[1][0].toUpperCase();
  }

  return (
  <div class="phone-image">
    <div
        className={'window'}
    >
        <Header name={data.name} initials={initialiseName()}/>
        <MessageHistory messages={data.messages}/>
        <CollapsedInputFooter spotifyURI={data.spotifyURI}/>
    </div>
  </div>
)}

const domContainer = document.querySelector('#react-component-container');

ReactDOM.render(React.createElement(Phone), domContainer);
</script>
<link rel="stylesheet" href="./index.css"/>
</foot>
</html>
